<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant Selector</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        #sidebar {
            width: 200px;
            height: 100%;
            position: fixed;
            top: 0;
            left: 0;
            background-color: #f4f4f4;
            padding: 20px;
            overflow-y: auto;
        }
        #map {
            margin-left: 220px;
            height: 100vh;
        }
        select {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>

<div id="sidebar">
    <h3>Selecteer Land</h3>
    <select id="country-select" onchange="filterByCountry()">
        <option value="">Selecteer een land</option>
    </select>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
// Laad de restaurants van een lokaal data.json bestand
let restaurants = [];

// Haal de data op via een fetch-aanroep naar het lokaal bestand (data.json)
fetch('data.json')
    .then(response => response.json())
    .then(data => {
        restaurants = data; // Bewaar de data in de restaurants array
        initializePage(restaurants); // Initialiseer de pagina met de opgehaalde data
    })
    .catch(error => console.error('Error loading the data:', error));

function initializePage(restaurants) {
    // Groeperen van restaurants per land
    const countries = [...new Set(restaurants.map(restaurant => restaurant.country))].sort();

    // Sidebar invullen met landen
    const selectElement = document.getElementById('country-select');
    countries.forEach(country => {
        const option = document.createElement('option');
        option.value = country;
        option.textContent = country;
        selectElement.appendChild(option);
    });

    // Leaflet map initialiseren
    const map = L.map('map').setView([52.370216, 4.895168], 6); // Startpunt is Amsterdam, wijzig dit indien nodig

    // Voeg OpenStreetMap-tile laag toe
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    // Functie om restaurants te filteren op basis van het geselecteerde land
    function filterByCountry() {
        const selectedCountry = selectElement.value;
        const filteredRestaurants = selectedCountry
            ? restaurants.filter(restaurant => restaurant.country === selectedCountry)
            : restaurants;

        updateMap(filteredRestaurants);
    }

    // Functie om de kaart bij te werken met de gefilterde restaurants
    function updateMap(filteredRestaurants) {
        // Verwijder bestaande markers
        map.eachLayer(layer => {
            if (layer instanceof L.Marker) {
                map.removeLayer(layer);
            }
        });

        // Voeg nieuwe markers toe voor gefilterde restaurants
        filteredRestaurants.forEach(restaurant => {
            const marker = L.marker([restaurant.lat, restaurant.lng]).addTo(map);
            marker.bindPopup(`
                <strong>${restaurant.name}</strong><br>
                Keuken: ${restaurant.cuisine}<br>
                Land: ${restaurant.country}<br>
                <img src="${restaurant.flag}" alt="${restaurant.country} vlag" width="30"><br>
                <a href="${restaurant.google_maps_link}" target="_blank">Bekijk op Google Maps</a>
            `);
        });
    }

    // Initieel laden van alle restaurants op de kaart
    updateMap(restaurants);
}

</script>

</body>
</html>
